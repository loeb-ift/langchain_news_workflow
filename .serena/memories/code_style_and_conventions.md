# 代码风格和约定

## 编程语言
- **主要语言**: Python 3.10+
- **代码编码**: UTF-8

## 代码结构
- **模块化设计**: 项目被分为多个功能模块，如 pipeline.py（核心流程）、app_utils/（工具函数）、prompts/（提示词模板）等
- **数据模型**: 使用Python的`@dataclass`装饰器定义数据模型，如`InputConfig`, `AlphaOutput`等
- **类型注解**: 广泛使用Python的类型提示系统，提高代码可读性和IDE支持

## 命名约定
- **类名**: 使用大驼峰命名法，如`GradioNewsWorkflow`
- **函数名**: 使用小写字母加下划线的蛇形命名法，如`run_stage`, `show_prompt_preview`
- **变量名**: 全局常量使用全大写字母加下划线，如`OLLAMA_BASE_URL`；其他变量使用小写字母加下划线
- **文件和目录名**: 使用小写字母加下划线的蛇形命名法

## 文档字符串
- 使用三引号(`"""`)定义函数和类的文档字符串
- 文档字符串包含函数/类的目的、参数说明、返回值说明等

## 错误处理
- 对于关键操作，如JSON解析，有专门的错误处理逻辑和降级策略
- 使用`try-except`块捕获可能的异常并提供友好的错误信息

## 日志记录
- 使用Python的`logging`模块进行日志管理
- 有专门的日志函数用于记录关键操作和结果
- 支持将决策过程记录到CSV文件

## 测试
- 使用`pytest`框架进行单元测试和集成测试
- 测试文件位于`tests/`目录下
- 包含烟雾测试、边界条件测试、模拟模式测试等多种测试类型

## 环境配置
- 使用`.env`文件管理环境变量，如Ollama服务地址、模型名称等
- 提供`.env.example`作为配置示例
- 使用`python-dotenv`库加载环境变量

## 提示词管理
- 提示词模板存储在`prompts/`目录下的JSON文件中
- 支持按阶段、新闻类型、目标风格、语气等维度管理提示词
- 提供覆盖机制，允许用户在不修改原始文件的情况下自定义配置

## UI交互
- 命令行界面使用`Typer`库，提供彩色文本和交互式菜单
- Web UI使用`Gradio`库，提供友好的图形化界面
- UI文本和提示存储在`ui_texts.json`中，支持国际化和自定义

## 性能优化
- 对于可能耗时的操作，提供进度提示
- 支持模拟模式(`OLLAMA_MOCK`)，用于测试和开发
- 日志级别配置，减少不必要的输出

## 其他约定
- 代码中使用中文注释和提示信息
- 支持用户输入的全角数字和字母自动转换
- 提供重试机制，应对模型输出不理想的情况
- 注重输出质量，包括语言本地化检查（如中文标点和汉字检测）